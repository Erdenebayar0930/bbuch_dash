# Copilot Instructions for Daamal Next ERP Admin

## Project Overview
This is a Next.js-based ERP admin dashboard with Firebase authentication and per-company data isolation. The app uses a single Firebase project for user auth, while each company's ERP data resides in separate Firebase projects for security and scalability.

## Architecture
- **Authentication Flow**: Login/register on `/` (index.tsx) → Email verification → Company selection (`/company-select?uid=...`) → Dashboard (`/dashboard?company=...`)
- **Data Isolation**: Auth in `daamal-414d3` project; company-specific data fetched via `initFirebase` with dynamic configs
- **Layout**: Dashboard uses `DashboardLayout` (layout.tsx) with `Sidebar` and `Topbar` components
- **Components**: Reusable UI in `/components` (e.g., `DashboardCard`, `DataTable`, `Chart` with recharts)
- **Styling**: Tailwind CSS with responsive grid layouts (e.g., `grid grid-cols-1 md:grid-cols-3`)

## Key Patterns
- **Firebase Integration**: Use `src/lib/firebase.js` for auth singleton; `src/initFirebase.js` for per-company app initialization with caching
- **Routing**: Next.js pages router; use `useRouter` for query params (e.g., `router.query.uid`, `router.query.company`)
- **Auth State**: `onAuthStateChanged` in `useEffect` for user state management
- **Data Fetching**: Firestore `getDoc` for user companies; demo data hardcoded in components (e.g., `tableData` in page.tsx)
- **Error Handling**: Try-catch in async auth actions; display errors in state (e.g., `setError(err.message)`)
- **UI Conventions**: Tailwind classes for forms (`border p-2 w-full`), buttons (`bg-blue-600 text-white`), and layouts (`flex h-screen`)

## Developer Workflows
- **Start Dev**: `npm run dev` (runs `next dev`)
- **Build/Deploy**: `npm run build` then `npm start`
- **Firebase Setup**: Replace configs in `src/lib/firebase.js` (auth) and `src/pages/company-select.jsx` (example company config)
- **PWA**: Service worker generated by `next-pwa`; manifest in `/public`

## Common Tasks
- **Add New Component**: Place in `/components`, export from index if needed; use TypeScript for props
- **Integrate Chart**: Use `recharts` components (e.g., `LineChart`) in `Chart.tsx`
- **Handle Company Data**: Initialize Firebase app with `initFirebase(companyKey, config)`; fetch from Firestore
- **Navigation**: `router.push('/dashboard?company=' + company)` for redirects

## References
- Auth config: `src/lib/firebase.js`
- Company init: `src/initFirebase.js`
- Dashboard layout: `src/pages/layout.tsx`
- Components: `src/components/`
- Demo data: `src/pages/page.tsx`